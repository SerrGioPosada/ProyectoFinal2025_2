<?xml version="1.0" encoding="UTF-8"?>

<?import javafx.geometry.*?>
<?import javafx.scene.control.*?>
<?import javafx.scene.layout.*?>
<?import javafx.scene.image.ImageView?>

<!-- ScrollPane root for responsive design -->
<ScrollPane fitToWidth="true" fitToHeight="true" styleClass="login-scroll" pannable="true"
            xmlns="http://javafx.com/javafx/21" xmlns:fx="http://javafx.com/fxml/1"
            fx:controller="co.edu.uniquindio.poo.ProyectoFinal2025_2.Controller.ForgotPasswordController">

   <StackPane alignment="CENTER" maxWidth="Infinity" prefWidth="Infinity" styleClass="login-background-pane">

      <VBox styleClass="login-container" alignment="CENTER" spacing="25">

         <!-- Logo Circle -->
         <HBox alignment="CENTER">
            <StackPane styleClass="logo-circle">
               <Label text="SD" styleClass="logo-text"/>
            </StackPane>
         </HBox>

         <!-- Welcome Text -->
         <VBox alignment="CENTER" spacing="5">
            <Label text="¿Olvidaste tu contraseña?" styleClass="welcome-text"/>
            <Label text="No te preocupes, te ayudaremos a recuperarla" styleClass="welcome-text"/>
         </VBox>

         <!-- Step Indicator -->
         <HBox alignment="CENTER" spacing="40" fx:id="stepIndicatorContainer">
            <VBox alignment="CENTER" spacing="5" fx:id="step1Container">
               <StackPane styleClass="logo-circle" prefWidth="50" prefHeight="50"
                         style="-fx-pref-width: 50; -fx-pref-height: 50; -fx-min-width: 50; -fx-min-height: 50; -fx-max-width: 50; -fx-max-height: 50;">
                  <Label text="1" styleClass="logo-text" style="-fx-font-size: 24;"/>
               </StackPane>
               <Label text="Verificación" styleClass="welcome-text" style="-fx-font-size: 12;"/>
            </VBox>

            <Separator prefWidth="80" styleClass="divider"/>

            <VBox alignment="CENTER" spacing="5" fx:id="step2Container" opacity="0.5">
               <StackPane styleClass="logo-circle" prefWidth="50" prefHeight="50"
                         style="-fx-pref-width: 50; -fx-pref-height: 50; -fx-min-width: 50; -fx-min-height: 50; -fx-max-width: 50; -fx-max-height: 50;">
                  <Label text="2" styleClass="logo-text" style="-fx-font-size: 24;"/>
               </StackPane>
               <Label text="Nueva Contraseña" styleClass="welcome-text" style="-fx-font-size: 12;"/>
            </VBox>
         </HBox>

         <!-- Form Container -->
         <VBox spacing="20" styleClass="form-container">

            <!-- STEP 1: Verification Form -->
            <VBox spacing="20" fx:id="verificationForm">

               <Label text="Paso 1: Verificación de Identidad" styleClass="welcome-text"
                     style="-fx-font-size: 16; -fx-font-weight: bold;"/>

               <!-- Email Field -->
               <VBox spacing="5">
                  <Label fx:id="lblEmailFloat" text="EMAIL" styleClass="floating-label-top"/>
                  <StackPane styleClass="input-container">
                     <TextField fx:id="txtEmail" styleClass="modern-input" promptText="EMAIL"/>
                  </StackPane>
               </VBox>

               <!-- Name Field (for verification) -->
               <VBox spacing="5">
                  <Label fx:id="lblNameFloat" text="NOMBRE COMPLETO" styleClass="floating-label-top"/>
                  <StackPane styleClass="input-container">
                     <TextField fx:id="txtName" styleClass="modern-input" promptText="NOMBRE COMPLETO"/>
                  </StackPane>
                  <Label text="Ingresa tu nombre para verificar tu identidad" styleClass="form-label-small"
                        style="-fx-text-fill: rgba(255, 255, 255, 0.7);"/>
               </VBox>

               <!-- Verify Button -->
               <Button fx:id="btnVerify" text="VERIFICAR IDENTIDAD" styleClass="signin-button"
                      onAction="#handleVerify"/>

               <!-- Verification Error Label -->
               <Label fx:id="lblVerificationError" styleClass="error-label" visible="false" managed="false"/>
            </VBox>

            <!-- STEP 2: New Password Form -->
            <VBox spacing="15" fx:id="passwordResetForm" visible="false" managed="false">

               <Label text="Paso 2: Nueva Contraseña" styleClass="welcome-text"
                     style="-fx-font-size: 16; -fx-font-weight: bold;"/>

               <!-- Password Requirements Info -->
               <VBox spacing="5" styleClass="info-box" style="-fx-padding: 15;">
                  <Label text="Requisitos de la contraseña:" styleClass="form-label"
                        style="-fx-text-fill: #0c5460; -fx-font-weight: bold;"/>
                  <Label text="• Mínimo 8 caracteres" styleClass="form-label-small"
                        style="-fx-text-fill: #0c5460;"/>
                  <Label text="• Al menos una mayúscula y una minúscula" styleClass="form-label-small"
                        style="-fx-text-fill: #0c5460;"/>
                  <Label text="• Al menos un número" styleClass="form-label-small"
                        style="-fx-text-fill: #0c5460;"/>
                  <Label text="• Al menos un carácter especial (!@#$%^&amp;*...)" styleClass="form-label-small"
                        style="-fx-text-fill: #0c5460;"/>
               </VBox>

               <!-- New Password Field -->
               <VBox spacing="5">
                  <Label fx:id="lblPasswordFloat" text="NUEVA CONTRASEÑA" styleClass="floating-label-top"/>
                  <HBox spacing="10" alignment="CENTER_LEFT">
                     <StackPane styleClass="input-container" HBox.hgrow="ALWAYS">
                        <PasswordField fx:id="txtPassword" styleClass="modern-input" promptText="NUEVA CONTRASEÑA"/>
                        <TextField fx:id="txtPasswordVisible" styleClass="modern-input" promptText="NUEVA CONTRASEÑA"
                                 visible="false" managed="false"/>
                     </StackPane>
                     <ImageView fx:id="imgTogglePassword" styleClass="password-toggle-outside"
                              fitWidth="24" fitHeight="24" preserveRatio="true" pickOnBounds="true"/>
                  </HBox>
               </VBox>

               <!-- Confirm Password Field -->
               <VBox spacing="5">
                  <Label fx:id="lblConfirmPasswordFloat" text="CONFIRMAR CONTRASEÑA" styleClass="floating-label-top"/>
                  <HBox spacing="10" alignment="CENTER_LEFT">
                     <StackPane styleClass="input-container" HBox.hgrow="ALWAYS">
                        <PasswordField fx:id="txtConfirmPassword" styleClass="modern-input"
                                     promptText="CONFIRMAR CONTRASEÑA"/>
                        <TextField fx:id="txtConfirmPasswordVisible" styleClass="modern-input"
                                 promptText="CONFIRMAR CONTRASEÑA" visible="false" managed="false"/>
                     </StackPane>
                     <ImageView fx:id="imgToggleConfirmPassword" styleClass="password-toggle-outside"
                              fitWidth="24" fitHeight="24" preserveRatio="true" pickOnBounds="true"/>
                  </HBox>
               </VBox>

               <!-- Reset Button -->
               <Button fx:id="btnResetPassword" text="CAMBIAR CONTRASEÑA" styleClass="signin-button"
                      onAction="#handleResetPassword"/>

               <!-- Reset Error Label -->
               <Label fx:id="lblResetError" styleClass="error-label" visible="false" managed="false"/>
            </VBox>

            <!-- Success Message -->
            <VBox spacing="10" fx:id="successMessage" visible="false" managed="false" alignment="CENTER">
               <Label text="✓" styleClass="welcome-text" style="-fx-font-size: 48; -fx-text-fill: #28a745;"/>
               <Label text="¡Contraseña actualizada!" styleClass="welcome-text"
                     style="-fx-font-size: 18; -fx-font-weight: bold; -fx-text-fill: #28a745;"/>
               <Label text="Tu contraseña ha sido cambiada exitosamente" styleClass="welcome-text"/>
               <Button text="VOLVER AL LOGIN" styleClass="signin-button" onAction="#handleBackToLogin"
                      prefWidth="300"/>
            </VBox>

            <!-- Divider -->
            <HBox alignment="CENTER" spacing="10">
               <Separator styleClass="divider" HBox.hgrow="ALWAYS"/>
            </HBox>

            <!-- Back to Login Link -->
            <Label fx:id="lblBackToLogin" text="Volver al inicio de sesión" styleClass="link-label"
                  onMouseClicked="#handleBackToLogin"/>

         </VBox>

         <!-- Bottom Spacing -->
         <VBox prefHeight="50"/>

      </VBox>
   </StackPane>
</ScrollPane>
