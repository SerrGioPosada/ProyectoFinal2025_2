<?xml version="1.0" encoding="UTF-8"?>

<?import javafx.geometry.Insets?>
<?import javafx.scene.control.*?>
<?import javafx.scene.layout.*?>

<ScrollPane xmlns="http://javafx.com/javafx/21"
            xmlns:fx="http://javafx.com/fxml/1"
            fx:controller="co.edu.uniquindio.poo.ProyectoFinal2025_2.Controller.DeliveryShipmentsController"
            styleClass="scroll-base"
            fitToWidth="true">

    <VBox spacing="20" styleClass="content-area">
        <padding>
            <Insets top="20" right="20" bottom="20" left="20"/>
        </padding>

        <!-- Header Section -->
        <HBox alignment="CENTER_LEFT" spacing="20" styleClass="header-section">
            <VBox spacing="3" HBox.hgrow="ALWAYS">
                <Label text="Mis Envíos Asignados" styleClass="page-title"/>
                <Label text="Gestiona y actualiza el estado de tus envíos" styleClass="info-label"/>
            </VBox>
            <Button text="Actualizar" onAction="#handleRefresh" styleClass="btn-primary"/>
        </HBox>

        <!-- Statistics Cards -->
        <GridPane hgap="10" vgap="10">
            <columnConstraints>
                <ColumnConstraints percentWidth="25"/>
                <ColumnConstraints percentWidth="25"/>
                <ColumnConstraints percentWidth="25"/>
                <ColumnConstraints percentWidth="25"/>
            </columnConstraints>

            <VBox styleClass="stat-card-compact" spacing="5" GridPane.columnIndex="0">
                <Label text="Total" styleClass="stat-label-compact"/>
                <Label fx:id="lblTotal" text="0" styleClass="stat-value-compact"/>
            </VBox>

            <VBox styleClass="stat-card-compact-warning" spacing="5" GridPane.columnIndex="1">
                <Label text="Pendientes" styleClass="stat-label-compact"/>
                <Label fx:id="lblPending" text="0" styleClass="stat-value-compact"/>
            </VBox>

            <VBox styleClass="stat-card-compact-info" spacing="5" GridPane.columnIndex="2">
                <Label text="En Tránsito" styleClass="stat-label-compact"/>
                <Label fx:id="lblInTransit" text="0" styleClass="stat-value-compact"/>
            </VBox>

            <VBox styleClass="stat-card-compact-success" spacing="5" GridPane.columnIndex="3">
                <Label text="Entregados" styleClass="stat-label-compact"/>
                <Label fx:id="lblDelivered" text="0" styleClass="stat-value-compact"/>
            </VBox>
        </GridPane>

        <!-- Collapsible Filters Section -->
        <VBox spacing="15" styleClass="section-container">
            <HBox alignment="CENTER_LEFT" spacing="10">
                <Label text="Filtros" styleClass="section-title" HBox.hgrow="ALWAYS"/>
                <Button fx:id="btnCollapseToggle" text="▲" onAction="#toggleCollapse"
                        styleClass="btn-icon"/>
            </HBox>

            <VBox fx:id="collapsibleSection" spacing="15">
                <HBox spacing="15" alignment="CENTER_LEFT" styleClass="filter-section">
                    <Label text="Filtros:" styleClass="filter-label"/>
                    <ComboBox fx:id="filterStatus" prefWidth="150" styleClass="combo-box"/>
                    <TextField fx:id="searchField" promptText="Buscar por ID o dirección..."
                               prefWidth="300" styleClass="search-field"/>
                    <Button text="Limpiar" onAction="#handleClearFilters" styleClass="btn-secondary"/>
                </HBox>
            </VBox>
        </VBox>

        <!-- Tab Buttons - Above Table -->
        <HBox spacing="10" alignment="CENTER_LEFT">
            <Button fx:id="btnTabAll" text="Todos" onAction="#handleShowAllShipments"
                    styleClass="tab-button-active"/>
            <Button fx:id="btnTabPending" text="Pendientes" onAction="#handleShowPendingShipments"
                    styleClass="tab-button"/>
            <Button fx:id="btnTabInTransit" text="En Tránsito" onAction="#handleShowInTransitShipments"
                    styleClass="tab-button"/>
            <Button fx:id="btnTabDelivered" text="Entregados" onAction="#handleShowDeliveredShipments"
                    styleClass="tab-button"/>
        </HBox>

        <!-- Tables Section - Always Visible, Resizes with Collapsible -->
        <VBox spacing="15" VBox.vgrow="ALWAYS">
            <!-- Tab Content: All Shipments -->
            <VBox fx:id="tabContentAll" spacing="15" managed="true" visible="true" VBox.vgrow="ALWAYS">
                <TableView fx:id="shipmentsTableAll" VBox.vgrow="ALWAYS" styleClass="data-table">
                    <columns>
                        <TableColumn fx:id="colShipmentId" text="ID Envío" prefWidth="120"/>
                        <TableColumn fx:id="colOrigin" text="Origen" prefWidth="150"/>
                        <TableColumn fx:id="colDestination" text="Destino" prefWidth="150"/>
                        <TableColumn fx:id="colStatus" text="Estado" prefWidth="120"/>
                        <TableColumn fx:id="colDate" text="Fecha" prefWidth="100"/>
                        <TableColumn fx:id="colCost" text="Costo" prefWidth="100"/>
                    </columns>
                    <columnResizePolicy>
                        <TableView fx:constant="CONSTRAINED_RESIZE_POLICY"/>
                    </columnResizePolicy>
                    <placeholder>
                        <VBox alignment="CENTER" spacing="10" style="-fx-padding: 40;">
                            <Label text="No hay envíos asignados"
                                   style="-fx-font-size: 16px; -fx-text-fill: #6c757d;"/>
                            <Label text="Los envíos asignados a ti aparecerán aquí"
                                   style="-fx-font-size: 14px; -fx-text-fill: #999999;"/>
                        </VBox>
                    </placeholder>
                </TableView>
            </VBox>

            <!-- Tab Content: Pending Shipments -->
            <VBox fx:id="tabContentPending" spacing="15" managed="false" visible="false" VBox.vgrow="ALWAYS">
                <TableView fx:id="shipmentsTablePending" VBox.vgrow="ALWAYS" styleClass="data-table">
                    <columns>
                        <TableColumn fx:id="colPendingId" text="ID Envío" prefWidth="120"/>
                        <TableColumn fx:id="colPendingOrigin" text="Origen" prefWidth="150"/>
                        <TableColumn fx:id="colPendingDestination" text="Destino" prefWidth="150"/>
                        <TableColumn fx:id="colPendingDate" text="Fecha Creación" prefWidth="120"/>
                        <TableColumn fx:id="colPendingCost" text="Costo" prefWidth="100"/>
                        <TableColumn fx:id="colPendingPriority" text="Prioridad" prefWidth="100"/>
                    </columns>
                    <columnResizePolicy>
                        <TableView fx:constant="CONSTRAINED_RESIZE_POLICY"/>
                    </columnResizePolicy>
                    <placeholder>
                        <VBox alignment="CENTER" spacing="10" style="-fx-padding: 40;">
                            <Label text="No hay envíos pendientes"
                                   style="-fx-font-size: 16px; -fx-text-fill: #6c757d;"/>
                            <Label text="¡Buen trabajo! No tienes envíos pendientes de recoger"
                                   style="-fx-font-size: 14px; -fx-text-fill: #999999;"/>
                        </VBox>
                    </placeholder>
                </TableView>
            </VBox>

            <!-- Tab Content: In Transit Shipments -->
            <VBox fx:id="tabContentInTransit" spacing="15" managed="false" visible="false" VBox.vgrow="ALWAYS">
                <TableView fx:id="shipmentsTableInTransit" VBox.vgrow="ALWAYS" styleClass="data-table">
                    <columns>
                        <TableColumn fx:id="colTransitId" text="ID Envío" prefWidth="120"/>
                        <TableColumn fx:id="colTransitOrigin" text="Origen" prefWidth="150"/>
                        <TableColumn fx:id="colTransitDestination" text="Destino" prefWidth="150"/>
                        <TableColumn fx:id="colTransitPickupDate" text="Fecha Recogida" prefWidth="120"/>
                        <TableColumn fx:id="colTransitEstimated" text="Entrega Estimada" prefWidth="120"/>
                        <TableColumn fx:id="colTransitCost" text="Costo" prefWidth="100"/>
                    </columns>
                    <columnResizePolicy>
                        <TableView fx:constant="CONSTRAINED_RESIZE_POLICY"/>
                    </columnResizePolicy>
                    <placeholder>
                        <VBox alignment="CENTER" spacing="10" style="-fx-padding: 40;">
                            <Label text="No hay envíos en tránsito"
                                   style="-fx-font-size: 16px; -fx-text-fill: #6c757d;"/>
                            <Label text="Los envíos que estés entregando aparecerán aquí"
                                   style="-fx-font-size: 14px; -fx-text-fill: #999999;"/>
                        </VBox>
                    </placeholder>
                </TableView>
            </VBox>

            <!-- Tab Content: Delivered Shipments -->
            <VBox fx:id="tabContentDelivered" spacing="15" managed="false" visible="false" VBox.vgrow="ALWAYS">
                <TableView fx:id="shipmentsTableDelivered" VBox.vgrow="ALWAYS" styleClass="data-table">
                    <columns>
                        <TableColumn fx:id="colDeliveredId" text="ID Envío" prefWidth="120"/>
                        <TableColumn fx:id="colDeliveredOrigin" text="Origen" prefWidth="150"/>
                        <TableColumn fx:id="colDeliveredDestination" text="Destino" prefWidth="150"/>
                        <TableColumn fx:id="colDeliveredDate" text="Fecha Entrega" prefWidth="120"/>
                        <TableColumn fx:id="colDeliveredCost" text="Costo" prefWidth="100"/>
                        <TableColumn fx:id="colDeliveredRating" text="Calificación" prefWidth="100"/>
                    </columns>
                    <columnResizePolicy>
                        <TableView fx:constant="CONSTRAINED_RESIZE_POLICY"/>
                    </columnResizePolicy>
                    <placeholder>
                        <VBox alignment="CENTER" spacing="10" style="-fx-padding: 40;">
                            <Label text="No hay envíos entregados"
                                   style="-fx-font-size: 16px; -fx-text-fill: #6c757d;"/>
                            <Label text="Los envíos que hayas entregado aparecerán aquí"
                                   style="-fx-font-size: 14px; -fx-text-fill: #999999;"/>
                        </VBox>
                    </placeholder>
                </TableView>
            </VBox>
        </VBox>

        <!-- Info Card -->
        <VBox styleClass="info-card" spacing="10">
            <Label text="ℹ️ Información Importante" styleClass="label-bold"/>
            <Label text="• Haz click derecho sobre un envío para ver opciones rápidas"
                   styleClass="info-label" wrapText="true"/>
            <Label text="• Usa las pestañas para organizar tus envíos por estado"
                   styleClass="info-label" wrapText="true"/>
            <Label text="• Los filtros te ayudan a encontrar envíos específicos rápidamente"
                   styleClass="info-label" wrapText="true"/>
        </VBox>

    </VBox>
</ScrollPane>
